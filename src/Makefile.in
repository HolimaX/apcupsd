# src/Makefile.in
#
# Copyright (C) 1999-2002 Riccardo Facchetti <riccardo@master.oasi.gpa.it>
#

# Default variables
@VARIABLES@
# TOP source directory.
topdir = @top_srcdir@
top_builddir = $(topdir)

subdirs = lib drivers @WIN32@ @INTLSUB@ @POSUB@ @LIBGD@ @CGI@

gobjs = apcnet.o apcreports.o apcaction.o apcnis.o apcdevice.o
dobjs = apcupsd.o apcoptd.o
nobjs = apcnisd.o
tobjs = apctest.o apcoptd.o
aobjs = apcaccess.o
sobjs = smtp.o
fobjs = powerflute.o
xobjs = devicedbg.o apcoptd.o apcaction.o

allexe = apcupsd @APCTEST@ @APCACCESS@ @SMTP@ @POWERFLUTE@ @APCNISD@

# Include the default make targets: to be put before the all-targets: rule.
@TARGETS@

all-targets: $(allexe)

apcupsd: $(dobjs) $(gobjs) $(LIBS) $(WINAPC)
	$(CC) $(LDFLAGS) $(dobjs) $(gobjs) $(LIBS) $(WINAPC) $(WINLIBS) -o apcupsd

apcnisd: $(nobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(nobjs) $(LIBS) -o apcnisd

apctest: $(tobjs) $(gobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(tobjs) $(gobjs) $(LIBS) -o apctest

devicedbg: $(xobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(xobjs) $(LIBS) -o devicedbg

apcaccess: $(aobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(aobjs) $(LIBS) -o apcaccess
 
smtp: $(sobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(sobjs) $(LIBS) -o smtp
 
powerflute: $(fobjs) $(LIBS)
	$(CC) $(LDFLAGS) $(fobjs) $(LIBS) @POWERLIBS@ -o powerflute

install: install-binary

install-:

install-binary: $(allexe)
	@$(ECHO) "Installing daemons ..."
	@$(SHELL) $(MKINSTALLDIRS) $(DESTDIR)$(sbindir)
	@$(INSTALL_PROGRAM) -s -m 700 apcupsd@EXEEXT@ \
		$(DESTDIR)$(sbindir)/apcupsd@EXEEXT@
	@$(MAKE) install-@APCNISD@
	@$(MAKE) install-@APCACCESS@
	@$(MAKE) install-@SMTP@
	@$(MAKE) install-@POWERFLUTE@
	@$(MAKE) install-@CGI@

install-apcaccess:
	@$(INSTALL_PROGRAM) -s -m 755 apcaccess@EXEEXT@ \
		$(DESTDIR)$(sbindir)/apcaccess@EXEEXT@

install-smtp:
	@$(INSTALL_PROGRAM) -s -m 755 smtp@EXEEXT@ \
		$(DESTDIR)$(sbindir)/smtp@EXEEXT@

install-apcnisd:
	@$(INSTALL_PROGRAM) -s -m 700 apcnisd@EXEEXT@ \
		$(DESTDIR)$(sbindir)/apcnisd@EXEEXT@

install-powerflute:
	@$(INSTALL_PROGRAM) -s -m 755 powerflute@EXEEXT@ \
		$(DESTDIR)$(sbindir)/powerflute@EXEEXT@
install-cgi:
	(cd cgi/; $(MAKE) install)

uninstall:
	@$(ECHO) "Removing daemons ..."
	@$(RMF) $(DESTDIR)$(sbindir)/apcupsd@EXEEXT@
	@$(RMF) $(DESTDIR)$(sbindir)/apcnisd@EXEEXT@
	@$(RMF) $(DESTDIR)$(sbindir)/apcaccess@EXEEXT@
	@$(RMF) $(DESTDIR)$(sbindir)/apctest@EXEEXT@
	@$(RMF) $(DESTDIR)$(sbindir)/powerflute@EXEEXT@

clean: targetclean
	$(RM) -f devicedbg

distclean: targetdistclean
	$(RMF) Makefile

# -----------------------------------------------------------------------
# DO NOT DELETE THIS LINE -- make depend depends on it.
