# Default variables
@VARIABLES@
# TOP source directory.
topdir = @topdir@
top_builddir = $(topdir)
bindir=$(prefix)/bin
libdir=$(prefix)/lib
libexecdir=$(prefix)/libexec
datadir=$(prefix)/share
sysconfdir=/etc

# Include the default make targets: to be put before the all-targets: rule.
@TARGETS@

# Subprogram selection
allexe = @GAPCMON@

gapcmon_OBJS = gapcmon.o eggtrayicon.o gethostname.o
pixmaps_DATA = charging.png onbatt.png online.png apcupsd.png unplugged.png gapc_prefs.png

all-targets: $(allexe)

gapcmon: $(gapcmon_OBJS)
	$(LD) -o $@ $(gapcmon_OBJS) @GAPCMON_LIBS@ -lX11 -lXext $(X_LIBS) $(X_EXTRA_LIBS)

gapcmon.o: gapcmon.c 
	$(CC) -c $(CFLAGS) @GAPCMON_CFLAGS@ -DICON_DIR=\"$(DESTDIR)$(prefix)\" $(X_CFLAGS) $<

eggtrayicon.o: eggtrayicon.c  
	$(CC) -c $(CFLAGS) @GAPCMON_CFLAGS@ $(X_CFLAGS) $<

gethostname.o: gethostname.c  
	$(CC) -c $(CFLAGS) @GAPCMON_CFLAGS@ $<

install: install-binary

install-:

install-binary: $(allexe)
	@$(ECHO) "Installing selected gapcmon versions ..."
	@$(SHELL) $(MKINSTALLDIRS) $(DESTDIR)$(bindir)
	@$(SHELL) $(MKINSTALLDIRS) $(DESTDIR)$(datadir)/pixmaps
	@$(SHELL) $(MKINSTALLDIRS) $(DESTDIR)$(datadir)/applications
	$(MAKE) STRIP=$(STRIP) DESTDIR=$(DESTDIR) install-pixmaps
	$(MAKE) STRIP=$(STRIP) DESTDIR=$(DESTDIR) install-@GAPCMON@

install-gapcmon: gapcmon
	$(INSTALL_PROGRAM) $(STRIP) -m 755 gapcmon	$(DESTDIR)$(bindir)/gapcmon@EXEEXT@
	@$(INSTALL_PROGRAM) -m 755 gapcmon.desktop	$(DESTDIR)${datadir}/applications/gapcmon.desktop

install-pixmaps: $(pixmaps_DATA)
	$(INSTALL_PROGRAM) -m 744 apcupsd.png		$(DESTDIR)$(datadir)/pixmaps/apcupsd.png		
	$(INSTALL_PROGRAM) -m 744 online.png		$(DESTDIR)$(datadir)/pixmaps/online.png
	$(INSTALL_PROGRAM) -m 744 onbatt.png		$(DESTDIR)$(datadir)/pixmaps/onbatt.png
	$(INSTALL_PROGRAM) -m 744 charging.png		$(DESTDIR)$(datadir)/pixmaps/charging.png
	$(INSTALL_PROGRAM) -m 744 unplugged.png		$(DESTDIR)$(datadir)/pixmaps/unplugged.png
	$(INSTALL_PROGRAM) -m 744 gapc_prefs.png	$(DESTDIR)$(datadir)/pixmaps/gapc_prefs.png

uninstall:
	@$(ECHO) "Removing gapcmon ..."
	$(RMF) $(DESTDIR)$(datadir)/pixmaps/apcupsd.png
	$(RMF) $(DESTDIR)$(datadir)/pixmaps/unplugged.png
	$(RMF) $(DESTDIR)$(datadir)/pixmaps/online.png
	$(RMF) $(DESTDIR)$(datadir)/pixmaps/onbatt.png
	$(RMF) $(DESTDIR)$(datadir)/pixmaps/charging.png
	$(RMF) $(DESTDIR)${datadir}/applications/gapc_prefs.png
	$(RMF) $(DESTDIR)${datadir}/applications/gapcmon.desktop	
	$(RMF) $(DESTDIR)$(bindir)/gapcmon@EXEEXT@

clean: targetclean

distclean: targetdistclean
	$(RMF) @GAPCMON@@EXEEXT@
	$(RMF) Makefile
	$(RMF) -r CVS
	
# -----------------------------------------------------------------------
# DO NOT DELETE THIS LINE -- make depend depends on it.
