<preface><title>Release Notes</title>

<para>This release contains a good number of cleanups and bug fixes to
prior 3.10.x versions, and is intended to be the official release.
See the ChangeLog below for more details.</para>

<sect1><title>New Features in in 3.10.6</title>

<para>This release contains a good number of cleanups and bug fixes to
prior 3.10.x versions, and is intended to be the official release. See
the ChangeLog below for more details.</para>

<para>Change Log</para>

<programlisting>
- Lots of updates to the document.
- Fixed a slave crash in master/slave mode. It was a missing setup_device,
  and was diagnosed and reported by Christian Schacht -- many thanks.
- Made non-existent header files non-fatal and added #ifdef 
  around sys/socket.h so it will compile on IRIX.
- Add Scott's latest apcupsd.conf with the hid-ups program code 
  (actually I had done this some time ago ...).
- Start a ReleaseNotes file
- Fixed a typo error (mine) that prevented Scott from building
  rpms. Strange, it worked for me????
- More DESTDIR cleanup for building non-root rpms.
- Add DESTDIR everywhere so we can build rpms non-root
- Additional documentation
- Add Scott's new apcupsd.spec
- On Hilary Jones suggestion, I fixed the ./configure message that
  is printed when no libgd is found to direct the user to the
  main source.
- Add Sergey Vlasov's kernel patch to the examples directory,
  and it replaces the previous patch.
  This patch now solves the killpower problem on Linux USB.
  &lt;apcupsd-source&gt;/examples/linux-2.4.20-alt-apc_usb_ups.patch
  notes are in: linux-usb-patch-email.txt
- Add TTY mode to apctest to communicated directly with UPS.
- Apply patch to linux-usb.c in killpower supplied by
  Sergey Vlasov (thanks!).
- Eliminate pow() function in linux-usb.c so that -lm is not needed.
- Add automatic detection of socklen_t
- I received a kernel patch from Sergey Vlasov that fixes
  the killpower problem on CS UPSes. apcupsd can now shutdown
  these devices! I've removed some debug code that was in
  the killpower routine and is not needed or used.
  I have put the kernel patch in:
  &lt;apcupsd-source&gt;/examples/linux-2.4.20-alt-hidups.patch
- When the Win32 version starts as a service, delete the
  NOLOGIN and PWRFAIL files to prevent later confusion.
  Thanks to Allen Crawford for pointing this out.
- Modify all Win32 program so that only windowed programs
  (apcupsd, popup) have the -mwindows flags. The others do not.
- Tweak apctest.c a bit -- add EEPROM programming (still a bit
  kludgy), but at least it can be done.
- Lots of clean ups for Cygwin stuff. Events now work, and exit.
- Clean up a few undefined symbols in building with everything on.
- Eliminate pid and serial port lock file on Win32 systems.
- Modify init script to use daemon so that STDIN/OUT, ... are   
  detached from the terminal and pointed to the log file. This
  prevents remotely logged in users who start apcupsd from being
  unable to log out.
- Made some mindor modifications to configure.in and aclocal.m4 to
  make consistent use of double quotes in test statements in
  response to problems with make install reported by Andrew Surratt.
- Thanks to Richard Schwaninger for finding and submitting a patch to
  the tcp-wrappers code that prevented it from working because of an
  invalid name. Fixed.
- Thanks to Andrew Reid for pointing out that the child reaping code
  should be clearing the pid slot if a -1 is returned. The pid table
  was filling up on his system due to killed children. Fixed
- A bug report against the Mandrake version of apcupsd indicates that
  apcupsd is not releasing /dev/console.  I've moved the close() of
  STDIN so that it is always executed to prevent this possibility.
- Implement very crude first cut of EEPROM programming in apctest.
  Set battery date, set UPS name, and print EEPROM values should
  work.

</programlisting>
</sect1>
<sect1><title>New Features in 3.10.5</title>

<para>This release is primarily version 3.10.4 but including a fix
that closes a root exploit of slave machines. In addition, it makes
the <option>--enable-master-slave</option> ./configure option work and
has a few updates to the Mandrake release. See the ChangeLog below for
more details.</para>

<para>Change Log</para>
<programlisting>
----&gt; Release apcupsd-3.10.5 (03 Feb 2003)
  03Feb03
  - Added an avsnprinf() routine.          
  - Replaced all vsprintf() calls with avsnprintf() to close a
    master/slave exploit that was published.
  - Remove awk processing of halt script for Mandrake as suggested by
    David Walser.
  02Feb03
  - Corrected --enable-oldnet to be --enable-master-slave as I
    had intended. Thanks to David Walser for pointing this out.
  - Added David Walser's apcupsd.spec.in for Mandrake and his
    changes to configure.in.

</programlisting>
</sect1>
<sect1><title>New Features in 3.10.4</title>

<para>See the list below for the detailed change log. Note, a number
of the details of the changes are only documented in the apcupsd.conf
file, and unfortunately not in much detail.</para>

<para>The main new features are:</para>

<itemizedlist>
<listitem><para>Support for USB UPSes on Linux. The killpower feature does
    not work though (most likely a kernel "bug").</para>
</listitem>
<listitem><para>Support for additional models and cables.</para>
</listitem>
<listitem><para>New cable for running BackUPS CS in Smart mode (possibly
    also the BackUPS ES).</para>
</listitem>
<listitem><para>The old master/slave code must be explicitly enabled with
    <option>--enable-master-slave</option> option on the 
    <command>./configure</command> line.</para>
</listitem>
<listitem><para>Different models are now handled by drivers.</para>
</listitem>
<listitem><para>NIS code, master/slave code, and the drivers can be
    individually configured giving a much smaller memory foot
    print.</para>
</listitem>
<listitem><para>A host of new configuration options to support
    enabling/disabling drivers and features.</para>
</listitem>
<listitem><para>Support for limiting what subnets the NIS code will listen
    to using the new NISIP configuration directive.</para>
</listitem>
<listitem><para>SNMP support.</para>
</listitem>
<listitem><para>Support for system provided gd libraries.</para>
</listitem>
<listitem><para>Source tree reorganization.</para>
</listitem>
</itemizedlist>


<para>Change Log:</para>
<programlisting>
----&gt; Release apcupsd-3.10.4 (21 Jan 2003)
  - Added error messages if old master/slave code called.
  - Reworked the messages for ./configure --help to be aligned and
    clearer for networking and master/slave
  - A number of important patches all supplied by Mirko Doelle.
  - Moved technotes for 2001 and 2002 into respective directories.
  - Created a new kes-3.10.4 file to which I will append if there
    are additional changes to 3.10.4. This will reduce the number
    of release note files.

  19Jan03
  - Fixed hangs in usb driver startup when could not open port by
    releasing the ups structure lock before the Error_abort calls.
    Thanks to Mirko Doelle for reporting this.
  - Fixed the default path for mkinstalldirs from $(topdir) to
    $(topdir)/autoconf.  Reported by Mirko.
  - Fixed configure.in to always create platform/apccontrol. Previously
    it was not being created for Debian. Reported by Mirko.
  - Removed Debian specific installation of apccontrol. Reported by
    Mirko.
  - Implemented code to display the apcupsd events with the most recent
    first. Code sent by Mirko, but I modified it slightly.

----&gt; Release apcupsd-3.10.3 (12 Dec 2002)
  - Tried to correct problems with Makefiles
  - Thanks to David Walser who pointed out where on the Sun, the make
    install was doing terrible things -- I found that there was
    a missing semicolon in the new Makefile.  Before my previous cleanup,
    there were actually 4 missing semicolons.  Hopefully this
    will correct the problem.
  - For a second time, David Walser came to the rescue finding the
    CGI install problem reported by lots of people.  The new code
    used &quot;make&quot; instead of $(MAKE) to call the CGI make.  Fixed.

  - Removed Makefile code that creates and sets permission bits on
    /tmp $(prefix) and $(exec-prefix)
  - Removed all occurrences of -z in the Makefiles (at least that I
    found) and replaced them with a more conservative formulation.
  - Removed the install-symlinks script that caused some problems
    on distributions with blanks in the DISTVER name.
  - Added install-symlinks to the suse Makefile.in. This is the
    only platform that currently uses it.


----&gt; Release apcupsd-3.10.2 (08 Nov 2002)
  - New cable design for BackUPS CS models to run it
    in Smart serial mode.
  - Corrected a major bug in the smart and net code where the
    status word was getting clobbered.

  - A few days ago, slither_man sent me an email with some 
    information on how to run a BackUPS CS in smart mode with
    a serial cable.  He found the information by assuming that
    the UPS supported Smart mode and through trial and error.
    Well, it works!!!!!!! Amazing!!!! Thanks slither_man.
  - Documentation for new CUSTOM-RJ54 cable that can be constructed
    from the end of an ethernet cable and a DB9F connector.

  - Changed all the MAIL instances in shell scripts into APCUPSD_MAIL.
    This helps keep separated the apcupsd specific shell variables from
    the generic $MAIL shell variable that points to the user's mailbox:

      riccardo at ao:~&gt; echo $MAIL
      /var/spool/mail/riccardo
      riccardo at ao:~&gt;

    An user reported that ./configure script transformed internal $MAIL
    executable program into her mailbox path. This may happen if the
    configure suite is broken (thing that I don't want to check further).
    That said, APCUPSD_MAIL now should always correctly point to the
    system default mail client program.
  - Made so that error_cleanup is a generic function called by the
    generic error handlers. Now if you want specific error_cleanup
    you don't need to write also specific error handlers, provided
    that error_cleanup don't accept parameters (i.e.
    specific_error_cleanup(void)) but if you want to have a specific
    error_cleanup with parameters you _must_ also write specific
    error_exit and error_out into which you will call the specific
    error_cleanup with parameters.
  - Made so that error_exit and error_out are generic handlers that
    can be assigned, if needed, to specific handlers by the main() of
    each program. If not, the Error* routines will use the generic
    versions in apclib.a.
  - Fixed wrong &quot;true&quot; usage in powerflute.
  - Cleaned up the terminate() functions.
  - Made DeviceVendor part of snmp DEVICE case insensitive.

----&gt; Release apcupsd-3.10.1 (16 Sep 2002)
  - Fixed a filling error with USB status dword.
  - Fixed autoconf check and dependances of -lpanel,etc with -lncurses.
  - Made more portable the apccontrol external scripts when calling the
    mailer (subject is now in the echo lines instead of relying on the
    presence of a -s switch on the mailer).
  - Added gentoo platform.
  - Added DESTDIR variable for platform packaging.
  - Fixed a off-by-one problem in events table.
  - Conditional compilation of old and new network code. Old network code
    disabled by default while new network code enabled by default.
  - Removed old src/apcnet.c.old, old implementation of old networking.

----&gt; Release apcupsd-3.10.0 (28 Jul 2002)
  - Added documentation for SNMP UPSes. Documented the use of
    --kill-on-powerfail switch during shutdown.
  - SuSE 8.0 is now supported.
  - Added forward declaration of inet_pton and localtime_r when they
    are extraobj.
  - Added inet_pton function. Implementation from Internet Software
    Consortium.
  - Made sp_flags private to the dumb driver.
  - Can't SET/CLEAR multiple flags: do them one by one. Fixed this
    bug in SNMP driver.
  - Added 127A and 128A cables support for dumb UPSes.
  - Implemented killpower for PowerNet MIB.
  - Implemented the SNMP driver for APC's PowerNet MIB.
  - Restructured UPSINFO so that now all the flags are contained
    into the Status bitmap.
  - *BSD should compile cleanly again.
  - Source tree is now under CVS revision control.
  - Added support for listening on specific IP addresses/subnets in
    NIS server, from Troy.
  - Doc updates, from Kern.

----&gt; Release apcupsd-3.9.9 (18 May 2002)
  - Applied final Kern's patch.
  - Added a little program 'devicedbg' to help in debugging device
    drivers with gdb. To compile, 'make devicedbg' in src/.
  - Cygwin platform added (reorganized old cygwin files).
  - Darwin platform added.
  - compile line is 'gcc -c -g -O2   -I../include  apcaction.c'.
  - reviewed all the platform makefiles.
  - use system libgd, searching for include files in system include dirs.
  - in case system does not have libgd, uses provided libgd.
  - put gd1.2 into master's contrib directory and a message if gd1.2
    is not present into src/gd1.2 (like default distribution will not)
    is issued at configure time to get gd1.2 from contrib and extract it
    into the src/ directory. Re-run config and all will be good and happy.
  - Sources reorganization.
  - Mandrake platform added.
</programlisting>
</sect1>
</preface>
